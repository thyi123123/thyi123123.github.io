<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart</title>
    <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script> <!-- EmailJS Script -->
    <style>
        /* Styles for the cart page */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        header {
            background: #35424a;
            color: white;
            padding: 10px 0;
            text-align: center;
        }
        .container {
            width: 80%;
            margin: auto;
        }
        .cart {
            background: #fff;
            padding: 20px;
            border: 1px solid #ddd;
            margin-top: 20px;
            border-radius: 5px;
        }
        .cart ul {
            list-style-type: none;
            padding: 0;
        }
        .cart li {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        input, button {
            padding: 10px;
            margin: 10px 0;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            background-color: #35424a;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #5a6d73;
        }
    </style>
</head>
<body>

<header>
    <h1>Your Cart</h1>
</header>

<div class="container">
    <div class="cart">
        <h2>Cart Items</h2>
        <ul id="cart-items">
            <!-- Cart items will be displayed here -->
        </ul>
        <p id="cart-total">Total: ₪ 0.00</p>

        <!-- Collect User Information -->
        <h3>Enter Your Information</h3>
        <input type="text" id="user-name" placeholder="Your Name" required />
        <input type="email" id="user-email" placeholder="Your Email" required />
        
        <!-- Checkout Button -->
        <button onclick="checkout()">Proceed to Checkout</button>
    </div>
</div>

<script>
// Initialize EmailJS
(function () {
    emailjs.init("your_user_id");  // Replace with your EmailJS user ID
})();

let cart = JSON.parse(localStorage.getItem('cart')) || [];

function updateCart() {
    const cartItems = document.getElementById('cart-items');
    const cartTotal = document.getElementById('cart-total');

    if (cart.length === 0) {
        cartItems.innerHTML = '<li>No items in cart.</li>';
        cartTotal.textContent = 'Total: ₪ 0.00';
    } else {
        cartItems.innerHTML = cart.map(item => `<li>${item.productName} - ₪ ${item.price}</li>`).join('');
        const total = cart.reduce((sum, item) => sum + item.price, 0).toFixed(2);
        cartTotal.textContent = `Total: ₪ ${total}`;
    }
}

// Checkout function (save the order)
function checkout() {
    const name = document.getElementById('user-name').value;
    const email = document.getElementById('user-email').value;

    if (!name || !email) {
        alert("Please enter both your name and email.");
        return;
    }

    const orderDate = new Date().toLocaleString();
    const order = {
        orderId: `ORD-${Date.now()}`,
        orderDate: orderDate,
        customerName: name,
        customerEmail: email,
        items: cart,
        total: cart.reduce((sum, item) => sum + item.price, 0).toFixed(2),
    };

    // Save order to localStorage
    let orders = JSON.parse(localStorage.getItem('orders')) || [];
    orders.push(order);
    localStorage.setItem('orders', JSON.stringify(orders));

    // Send email after order placement
    sendEmail(order);

    // Clear cart
    clearCart();

    alert(`Order placed successfully! Your Order ID is ${order.orderId}.`);
}

function sendEmail(order) {
    // Send email to admin
    const adminEmail = "admin@example.com"; // Admin's email address

    const emailTemplateParams = {
        orderId: order.orderId,
        orderDate: order.orderDate,
        customerName: order.customerName,
        customerEmail: order.customerEmail,
        items: order.items.map(item => `${item.productName} - ₪ ${item.price}`).join('<br>'),
        total: order.total,
        adminEmail: adminEmail,
    };

    // Send email to user and admin using EmailJS
    emailjs.send("your_service_id", "your_template_id", emailTemplateParams)
        .then(function (response) {
            console.log("Success", response);
        }, function (error) {
            console.log("Error", error);
        });
}

// Clear cart after checkout
function clearCart() {
    cart = [];
    localStorage.setItem('cart', JSON.stringify(cart)); // Clear cart in localStorage
    updateCart();
}

window.onload = updateCart;
</script>


</body>
</html>