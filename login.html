const GITHUB_USERNAME = "your-username";
const REPO_NAME = "your-repo";
const FILE_PATH = "users.json";
const TOKEN = "your-github-token";  // Store securely

async function getUsers() {
    const url = `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${REPO_NAME}/main/${FILE_PATH}`;
    try {
        let response = await fetch(url);
        let users = await response.json();
        return users;
    } catch (error) {
        console.error("Error fetching users:", error);
        return {};
    }
}

async function saveUsers(users) {
    const url = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FILE_PATH}`;
    let content = btoa(JSON.stringify(users, null, 2));
    
    let response = await fetch(url, {
        method: "PUT",
        headers: {
            "Authorization": `token ${TOKEN}`,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            message: "Update users",
            content: content,
            sha: await getFileSHA()
        })
    });
    return response.ok;
}

async function getFileSHA() {
    const url = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FILE_PATH}`;
    let response = await fetch(url, {
        headers: { "Authorization": `token ${TOKEN}` }
    });
    let data = await response.json();
    return data.sha;
}

async function login(username, password) {
    let users = await getUsers();
    if (users[username] && users[username].password === password) {
        localStorage.setItem("loggedInUser", username);
        localStorage.setItem("admin", users[username].role === "admin" ? "true" : "false");
        alert("Login successful!");
        window.location.href = users[username].role === "admin" ? "admin.html" : "index.html";
    } else {
        alert("Invalid username or password!");
    }
}

async function register(username, password, isAdmin = false) {
    let users = await getUsers();
    if (users[username]) {
        alert("Username already exists!");
        return false;
    }
    users[username] = { password, role: isAdmin ? "admin" : "user" };
    return await saveUsers(users);
}

async function removeUser(username) {
    let users = await getUsers();
    delete users[username];
    return await saveUsers(users);
}
